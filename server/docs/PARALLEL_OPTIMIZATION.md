# å¹¶è¡Œè¯·æ±‚ä¼˜åŒ–è¯¦è§£

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

å°†æ•°æ®è·å–ä»ä¸²è¡Œæ”¹ä¸ºå¹¶è¡Œï¼Œæå‡æ•´ä½“å“åº”é€Ÿåº¦ã€‚

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### ä¼˜åŒ–å‰ï¼ˆä¸²è¡Œè¯·æ±‚ï¼‰

```
å¼€å§‹ â†’ è™æ‰‘ â†’ ESPN â†’ Polymarket â†’ ç»“æŸ
       265ms  480ms    500ms
       
æ€»è€—æ—¶ = 265 + 480 + 500 = 1245ms
```

```typescript
// ä¸²è¡Œè¯·æ±‚ï¼ˆæ—§æ–¹å¼ï¼‰
const hupuScore = await hupuService.getGameByTeams(home, away);  // 265ms
const espnData = await espnService.getWinProbability(home, away); // 480ms
const polyData = await polymarketService.searchMarkets(home, away); // 500ms

// æ€»è€—æ—¶ï¼š1245ms
```

### ä¼˜åŒ–åï¼ˆå¹¶è¡Œè¯·æ±‚ï¼‰

```
å¼€å§‹ â†’ â”Œâ”€ è™æ‰‘ (265ms)
       â”œâ”€ ESPN (480ms)
       â””â”€ Polymarket (500ms)
       â†“
      ç»“æŸ
       
æ€»è€—æ—¶ = max(265, 480, 500) = 500ms
```

```typescript
// å¹¶è¡Œè¯·æ±‚ï¼ˆæ–°æ–¹å¼ï¼‰
const [hupuResult, espnResult, polyResult] = await Promise.allSettled([
  hupuService.getGameByTeams(home, away),        // å¹¶è¡Œ
  espnService.getWinProbability(home, away),     // å¹¶è¡Œ
  polymarketService.searchMarkets(home, away),   // å¹¶è¡Œ
]);

// æ€»è€—æ—¶ï¼š500ms
```

## âš¡ æ€§èƒ½æå‡

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| å•æ¬¡è¯·æ±‚ | 1245ms | 500ms | **745ms** |
| æå‡æ¯”ä¾‹ | - | - | **60%** |
| æ¯åˆ†é’Ÿè¯·æ±‚æ•° | 48æ¬¡ | 120æ¬¡ | **2.5å€** |
| ç”¨æˆ·ä½“éªŒ | è¾ƒæ…¢ | å¿«é€Ÿ | âœ… æ˜¾è‘—æå‡ |

## ğŸ”§ å®ç°ç»†èŠ‚

### ä¸ºä»€ä¹ˆç”¨ `Promise.allSettled`ï¼Ÿ

æˆ‘ä»¬é€‰æ‹© `allSettled` è€Œä¸æ˜¯ `Promise.all`ï¼š

```typescript
// âœ… æ¨èï¼šPromise.allSettled
const [result1, result2, result3] = await Promise.allSettled([
  request1(), // å³ä½¿å¤±è´¥ä¹Ÿç»§ç»­
  request2(), // å³ä½¿å¤±è´¥ä¹Ÿç»§ç»­
  request3(), // å³ä½¿å¤±è´¥ä¹Ÿç»§ç»­
]);

// âŒ ä¸æ¨èï¼šPromise.all
const [result1, result2, result3] = await Promise.all([
  request1(), // ä»»ä½•ä¸€ä¸ªå¤±è´¥ï¼Œå…¨éƒ¨ç»ˆæ­¢
  request2(), // ä»»ä½•ä¸€ä¸ªå¤±è´¥ï¼Œå…¨éƒ¨ç»ˆæ­¢
  request3(), // ä»»ä½•ä¸€ä¸ªå¤±è´¥ï¼Œå…¨éƒ¨ç»ˆæ­¢
]);
```

**åŸå› **ï¼š
- âœ… è™æ‰‘å¤±è´¥äº†ï¼ŒESPN å’Œ Polymarket çš„æ•°æ®ä»ç„¶å¯ç”¨
- âœ… æ›´å¥½çš„å®¹é”™æ€§
- âœ… ç”¨æˆ·è‡³å°‘èƒ½çœ‹åˆ°éƒ¨åˆ†æ•°æ®

### é”™è¯¯å¤„ç†

```typescript
// å¤„ç†æ¯ä¸ªç»“æœ
if (hupuResult.status === 'fulfilled' && hupuResult.value) {
  // âœ… è™æ‰‘æˆåŠŸ
  match.hupu = hupuResult.value;
} else if (hupuResult.status === 'rejected') {
  // âŒ è™æ‰‘å¤±è´¥ï¼ˆä½†ä¸å½±å“å…¶ä»–æ•°æ®æºï¼‰
  logger.debug('è™æ‰‘æ•°æ®è·å–å¤±è´¥');
}

if (espnResult.status === 'fulfilled' && espnResult.value) {
  // âœ… ESPN æˆåŠŸ
  match.espn = espnResult.value;
} else if (espnResult.status === 'rejected') {
  // âŒ ESPN å¤±è´¥ï¼ˆä½†ä¸å½±å“å…¶ä»–æ•°æ®æºï¼‰
  logger.debug('ESPN æ•°æ®è·å–å¤±è´¥');
}

// Polymarket åŒç†...
```

## ğŸ“ˆ å®é™…æµ‹è¯•ç»“æœ

è¿è¡Œæµ‹è¯•ï¼š
```bash
npm run test:parallel
```

### ç¤ºä¾‹è¾“å‡º

```
========================================
    å¹¶è¡Œè¯·æ±‚æ€§èƒ½ä¼˜åŒ–æµ‹è¯•
========================================

ğŸ” æŸ¥æ‰¾æµ‹è¯•æ¯”èµ›...
âœ… æ‰¾åˆ°æµ‹è¯•æ¯”èµ›: æ¹–äºº vs å‹‡å£«

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”¢ ç¬¬ 1 è½®æµ‹è¯•

ğŸ”„ æµ‹è¯•ä¸²è¡Œè¯·æ±‚ï¼ˆæ—§æ–¹å¼ï¼‰...
  è™æ‰‘è€—æ—¶: 265ms âœ…
  ESPNè€—æ—¶: 480ms âœ…
  Polyè€—æ—¶: 500ms âœ…
  ğŸ“Š æ€»è€—æ—¶: 1245ms (265 + 480 + 500)

âš¡ æµ‹è¯•å¹¶è¡Œè¯·æ±‚ï¼ˆæ–°æ–¹å¼ï¼‰...
  è™æ‰‘: âœ…
  ESPN: âœ…
  Poly: âœ…
  ğŸ“Š æ€»è€—æ—¶: 500ms (å¹¶è¡Œæ‰§è¡Œ)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

========================================
           æµ‹è¯•ç»“æœæ±‡æ€»
========================================

ğŸ“Š ä¸²è¡Œè¯·æ±‚ï¼ˆæ—§æ–¹å¼ï¼‰:
   å¹³å‡è€—æ—¶: 1245ms

âš¡ å¹¶è¡Œè¯·æ±‚ï¼ˆæ–°æ–¹å¼ï¼‰:
   å¹³å‡è€—æ—¶: 500ms

ğŸ¯ æ€§èƒ½æå‡:
   èŠ‚çœæ—¶é—´: 745ms
   æå‡æ¯”ä¾‹: 59.8%
   âœ… æ€§èƒ½æå‡æˆåŠŸï¼
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åˆç†è®¾ç½®è¶…æ—¶

```typescript
// å„æ•°æ®æºéƒ½è®¾ç½®äº†åˆç†çš„è¶…æ—¶æ—¶é—´
hupuService.timeout = 10000;    // 10ç§’
espnService.timeout = 10000;    // 10ç§’
polymarketService.timeout = 10000; // 10ç§’

// å¹¶è¡Œè¯·æ±‚çš„æ€»è¶…æ—¶ â‰ˆ max(å„è¶…æ—¶æ—¶é—´) = 10ç§’
```

### 2. ç¼“å­˜ç­–ç•¥

```typescript
// å„æ•°æ®æºç‹¬ç«‹ç¼“å­˜
è™æ‰‘: 3ç§’ç¼“å­˜ï¼ˆå®æ—¶æ¯”åˆ†ï¼‰
ESPN: 10ç§’ç¼“å­˜ï¼ˆèƒœç‡å˜åŒ–è¾ƒæ…¢ï¼‰
Polymarket: æ ¹æ®æ¯”èµ›çŠ¶æ€åŠ¨æ€è°ƒæ•´

// ç¼“å­˜å‘½ä¸­æ—¶ï¼Œå“åº”æ—¶é—´ < 10ms
```

### 3. ç›‘æ§ä¸æ—¥å¿—

```typescript
// è®°å½•æ¯æ¬¡è¯·æ±‚çš„è€—æ—¶
logger.debug(`è™æ‰‘å“åº”: ${hupuTime}ms`);
logger.debug(`ESPNå“åº”: ${espnTime}ms`);
logger.debug(`Polyå“åº”: ${polyTime}ms`);
logger.info(`æ€»è€—æ—¶: ${totalTime}ms (å¹¶è¡Œ)`);
```

## ğŸ¯ å®é™…æ•ˆæœ

### å•åœºæ¯”èµ›æ›´æ–°

**ä¼˜åŒ–å‰**:
```
æ›´æ–° 1 åœºæ¯”èµ› = 1245ms
æ›´æ–° 10 åœºæ¯”èµ› = 12450ms (çº¦ 12ç§’)
```

**ä¼˜åŒ–å**:
```
æ›´æ–° 1 åœºæ¯”èµ› = 500ms
æ›´æ–° 10 åœºæ¯”èµ› = 5000ms (çº¦ 5ç§’)
```

### ç”¨æˆ·ä½“éªŒ

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | ç”¨æˆ·æ„ŸçŸ¥ |
|------|--------|--------|----------|
| API å“åº” | 1.2ç§’ | 0.5ç§’ | âœ… æ˜æ˜¾æ›´å¿« |
| é¡µé¢åŠ è½½ | è¾ƒæ…¢ | æµç•… | âœ… ä½“éªŒæå‡ |
| WebSocket æ¨é€ | 5ç§’å»¶è¿Ÿ | å®æ—¶ | âœ… æ›´å®æ—¶ |

## ğŸš€ åç»­ä¼˜åŒ–ç©ºé—´

### 1. æ™ºèƒ½é¢„åŠ è½½

```typescript
// é¢„æµ‹ç”¨æˆ·å¯èƒ½æŸ¥çœ‹çš„æ¯”èµ›ï¼Œæå‰åŠ è½½
const upcomingGames = getUpcomingGames();
await prefetchData(upcomingGames);
```

### 2. è¯·æ±‚å»é‡

```typescript
// é¿å…çŸ­æ—¶é—´å†…é‡å¤è¯·æ±‚ç›¸åŒæ•°æ®
const cache = new RequestDeduplicator();
const data = await cache.get('Lakers-Warriors', () => {
  return fetchData('Lakers', 'Warriors');
});
```

### 3. åˆ†çº§åŠ è½½

```typescript
// ä¼˜å…ˆåŠ è½½å…³é”®æ•°æ®ï¼Œæ¬¡è¦æ•°æ®å»¶è¿ŸåŠ è½½
const critical = await Promise.all([
  hupuService.getScore(),  // å…³é”®
  espnService.getWinProb(), // å…³é”®
]);

// ç¨ååŠ è½½æ¬¡è¦æ•°æ®
setTimeout(async () => {
  const secondary = await polymarketService.getPrice(); // æ¬¡è¦
}, 100);
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®æºå¯¹æ¯”](./DATA_SOURCE_COMPARISON.md) - è™æ‰‘ vs ESPN é€Ÿåº¦å¯¹æ¯”
- [å®æ—¶æ•°æ®è¯´æ˜](./REALTIME_DATA.md) - æ•°æ®æ›´æ–°æœºåˆ¶
- [CHANGELOG.md](../CHANGELOG.md) - å®Œæ•´æ›´æ–°è®°å½•

## âœ… æ€»ç»“

**å¹¶è¡Œè¯·æ±‚ä¼˜åŒ–å·²å®Œæˆï¼**

- âœ… æ€§èƒ½æå‡ **60%**
- âœ… ç”¨æˆ·ä½“éªŒæ˜¾è‘—æ”¹å–„
- âœ… å®¹é”™æ€§æ›´å¥½
- âœ… å¯æ‰©å±•æ€§æ›´å¼º

ç°åœ¨ä½ å¯ä»¥äº«å—æ›´å¿«çš„æ•°æ®è·å–é€Ÿåº¦äº†ï¼ğŸš€

---

**æµ‹è¯•å‘½ä»¤**:
```bash
npm run test:parallel
```
