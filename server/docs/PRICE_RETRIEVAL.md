# Polymarket ä»·æ ¼è·å–æŒ‡å—

## âœ… åŠŸèƒ½çŠ¶æ€

**ä»·æ ¼è·å–åŠŸèƒ½å·²å®Œå…¨æ­£å¸¸å·¥ä½œï¼**

- âœ… æˆåŠŸç‡: **100%**ï¼ˆå¯¹äº Polymarket æœ‰å¸‚åœºçš„æ¯”èµ›ï¼‰
- âœ… ä¸‰å±‚æ¼æ–—åŒ¹é…å®Œå…¨å®ç°
- âœ… ä¸»å®¢åœºé¡ºåºé—®é¢˜å·²ä¿®å¤
- âœ… ä¸­æ–‡é˜Ÿåæ˜ å°„æ­£å¸¸å·¥ä½œ

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### æµ‹è¯•ä»·æ ¼è·å–

```bash
npx ts-node src/test/testPriceRetrieval.ts
```

**é¢„æœŸè¾“å‡º**:
```
âœ… æˆåŠŸ: 3 åœº
âŒ å¤±è´¥: 0 åœº
ğŸ“Š æˆåŠŸç‡: 100.0%

ğŸ‰ ä»·æ ¼è·å–åŠŸèƒ½æ­£å¸¸å·¥ä½œ!
```

### æµ‹è¯•å•åœºæ¯”èµ›

```javascript
import { polymarketService } from './services/polymarketService';

// è™æ‰‘çš„ä¸­æ–‡é˜Ÿåï¼ˆå¯ä»¥æ˜¯ä¸»å®¢åœºä»»æ„é¡ºåºï¼‰
const polyData = await polymarketService.searchNBAMarkets('çˆµå£«', 'ç‹¬è¡Œä¾ ');

if (polyData) {
  console.log('ä¸»é˜Ÿä»·æ ¼:', polyData.homePrice);
  console.log('å®¢é˜Ÿä»·æ ¼:', polyData.awayPrice);
  console.log('æµåŠ¨æ€§:', polyData.liquidity);
}
```

---

## ğŸ“Š è·å–åˆ°çš„æ•°æ®

### PolymarketData ç»“æ„

```typescript
interface PolymarketData {
  marketId: string;        // å¸‚åœºID
  homeTokenId: string;     // ä¸»é˜Ÿ token ID
  awayTokenId: string;     // å®¢é˜Ÿ token ID
  homePrice: number;       // ä¸»é˜Ÿä»·æ ¼ (0-1)
  awayPrice: number;       // å®¢é˜Ÿä»·æ ¼ (0-1)
  homeVolume?: number;     // ä¸»é˜Ÿäº¤æ˜“é‡
  awayVolume?: number;     // å®¢é˜Ÿäº¤æ˜“é‡
  liquidity?: number;      // æµåŠ¨æ€§
  endDate?: string;        // å¸‚åœºç»“æŸæ—¶é—´
}
```

### çœŸå®æ•°æ®ç¤ºä¾‹

```json
{
  "marketId": "0x9de10ba1a707de8b5f5ed1fc8a56059e1e73822454b62643cdb394b36b20f171",
  "homeTokenId": "123",
  "awayTokenId": "456",
  "homePrice": 0.605,
  "awayPrice": 0.395,
  "liquidity": 38737.084,
  "homeVolume": 2701436.2,
  "endDate": "2025-12-16T02:30:00Z"
}
```

---

## ğŸ¯ ä¸‰å±‚æ¼æ–—åŒ¹é…é€»è¾‘

### Layer 1: èŒƒå›´é”å®š

**è¿‡æ»¤æ¡ä»¶**:
- âœ… `series_id = "10345"` (NBA 2026)
- âœ… `active = true` (è¿›è¡Œä¸­/æœªç»“ç®—)
- âœ… `closed = false` (æœªå…³é—­)

**æ•ˆæœ**: ä»æ•°ç™¾ä¸ªå¸‚åœºç¼©å°åˆ° 10-50 ä¸ª NBA æ¯”èµ›

### Layer 2: åç§°é”šå®š

**åŒ¹é…æ¡ä»¶**:
- âœ… æ ‡é¢˜å¿…é¡»åŒæ—¶åŒ…å«ä¸¤ä¸ªé˜Ÿçš„å…³é”®è¯
- âœ… **ä¸åŒºåˆ†ä¸»å®¢åœºé¡ºåº**ï¼ˆè™æ‰‘å’Œ Polymarket å¯èƒ½ç›¸åï¼‰
- âœ… ä½¿ç”¨ä¸­æ–‡é˜Ÿåæ˜ å°„åˆ°è‹±æ–‡å…³é”®è¯

**ç¤ºä¾‹**:
- è™æ‰‘: "çˆµå£« vs ç‹¬è¡Œä¾ " 
- Polymarket: "Mavericks vs. Jazz"
- âœ… æˆåŠŸåŒ¹é…ï¼ï¼ˆå› ä¸ºéƒ½åŒ…å« Jazz å’Œ Mavericksï¼‰

### Layer 3: æ—¶é—´æ ¡éªŒ

**æ ¡éªŒé€»è¾‘**:
- âœ… Polymarket çš„ `endDate` å¿…é¡»æ™šäºè™æ‰‘çš„ `startTime`
- âœ… é˜²æ­¢åŒ¹é…åˆ°æœªæ¥æˆ–è¿‡å»çš„åŒåå¯¹å†³

---

## ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜

### é—®é¢˜ #1: ä¸»å®¢åœºé¡ºåºä¸åŒ¹é… âœ…

**é—®é¢˜**: åŒ¹é…æˆåŠŸç‡åªæœ‰ 33.3%

**åŸå› **: è™æ‰‘å’Œ Polymarket çš„ä¸»å®¢åœºå®šä¹‰å¯èƒ½ç›¸å

**è§£å†³**: Layer 2 ä¸å†åŒºåˆ†ä¸»å®¢åœºï¼Œåªè¦ä¸¤é˜Ÿåéƒ½åœ¨æ ‡é¢˜ä¸­å³å¯

**ç»“æœ**: æˆåŠŸç‡æå‡åˆ° 100%

### é—®é¢˜ #2: å·²ç»“æŸæœªç»“ç®—æ¯”èµ›æ— æ³•åŒ¹é… âœ…

**é—®é¢˜**: "å¿«èˆ¹ vs ç°ç†Š" æ¯”èµ›ç»“æŸåæ— æ³•åŒ¹é…

**åŸå› **: æ¯”èµ› endDate å·²è¿‡æœŸä½†å¸‚åœºä» activeï¼ˆç­‰å¾…ç»“ç®—ï¼‰

**è§£å†³**: ç§»é™¤ Layer 1 çš„ `endDate < now` æ£€æŸ¥

**ç»“æœ**: å·²ç»“æŸæœªç»“ç®—çš„æ¯”èµ›ä¹Ÿèƒ½æ­£ç¡®åŒ¹é…

### é—®é¢˜ #3: ä¸­æ–‡é˜Ÿåæ˜ å°„å¤±è´¥ âœ…

**é—®é¢˜**: "æ— æ³•æ‰¾åˆ°çƒé˜Ÿæ˜ å°„: æ´»å¡ æˆ– è€é¹°"

**åŸå› **: é”™è¯¯ä½¿ç”¨ `findTeamByEnglish` æŸ¥æ‰¾ä¸­æ–‡é˜Ÿå

**è§£å†³**: æ”¹ç”¨ `findTeamByChinese` å‡½æ•°

**ç»“æœ**: æ‰€æœ‰ä¸­æ–‡é˜Ÿåæ­£ç¡®æ˜ å°„

---

## ğŸ“¡ é€šè¿‡ API è·å–ä»·æ ¼

### REST API

```bash
# è·å–å•åœºæ¯”èµ›ï¼ˆåŒ…å«ä»·æ ¼ï¼‰
GET /api/matches/LAL-GSW-20251216

# å“åº”ç¤ºä¾‹
{
  "success": true,
  "data": {
    "id": "LAL-GSW-20251216",
    "homeTeam": { "name": "Lakers", "score": 102 },
    "awayTeam": { "name": "Warriors", "score": 98 },
    "poly": {
      "marketId": "0x...",
      "homePrice": 0.68,
      "awayPrice": 0.32,
      "liquidity": 100000
    }
  }
}
```

### WebSocket

```javascript
import { io } from 'socket.io-client';

const socket = io('http://localhost:3000');

socket.on('matchUpdate', (match) => {
  if (match.poly) {
    console.log('ä¸»é˜Ÿä»·æ ¼:', match.poly.homePrice);
    console.log('å®¢é˜Ÿä»·æ ¼:', match.poly.awayPrice);
  }
});
```

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### âœ… åº”è¯¥æˆåŠŸåŒ¹é…

1. **æ­£å¸¸æ¯”èµ›**: Lakers vs Warriors ä»Šå¤©çš„æ¯”èµ›
2. **ä¸»å®¢åœºç›¸å**: è™æ‰‘"çˆµå£« vs ç‹¬è¡Œä¾ "ï¼ŒPolymarket"Mavericks vs. Jazz"
3. **å·²ç»“æŸæœªç»“ç®—**: æ¯”èµ›ç»“æŸä½†å¸‚åœºè¿˜æœªç»“ç®—

### âŒ ä¸ä¼šåŒ¹é…

1. **å†å²æ¯”èµ›**: æ˜¨å¤©çš„æ¯”èµ›ï¼ˆactive=false æˆ– closed=trueï¼‰
2. **Polymarket æ— å¸‚åœº**: æŸäº›æ™®é€šæ¯”èµ› Polymarket å¯èƒ½æ²¡æœ‰å¼€ç›˜
3. **å•é˜ŸåŒ¹é…**: åªæ‰¾åˆ°ä¸€ä¸ªé˜Ÿåï¼ˆLayer 2 å¤±è´¥ï¼‰
4. **å…¶ä»–è¿åŠ¨**: NFLã€MLB ç­‰é NBA æ¯”èµ›

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **[MATCHING_LOGIC.md](./MATCHING_LOGIC.md)** - ä¸‰å±‚æ¼æ–—åŒ¹é…é€»è¾‘è¯¦ç»†è¯´æ˜
- **[API.md](../API.md)** - REST API & WebSocket å®Œæ•´æ–‡æ¡£
- **[TEAM_MAPPINGS.md](../TEAM_MAPPINGS.md)** - NBA çƒé˜Ÿæ˜ å°„é…ç½®

---

## ğŸ› æ•…éšœæ’æŸ¥

### ä»·æ ¼å§‹ç»ˆä¸º null

**æ£€æŸ¥é¡¹**:
1. Polymarket æ˜¯å¦ä¸ºè¯¥æ¯”èµ›å¼€ç›˜ï¼Ÿï¼ˆä¸æ˜¯æ‰€æœ‰æ¯”èµ›éƒ½æœ‰å¸‚åœºï¼‰
2. æŸ¥çœ‹æ—¥å¿—ä¸­çš„ `[Layer 1]`, `[Layer 2]`, `[Layer 3]` æ ‡è®°
3. è¿è¡Œ `npx ts-node src/test/debugPolymarketAPI.ts` æŸ¥çœ‹ Polymarket è¿”å›çš„æ‰€æœ‰æ¯”èµ›

### åŒ¹é…å¤±è´¥

**æ£€æŸ¥é¡¹**:
1. ç¡®è®¤çƒé˜Ÿæ˜ å°„å­˜åœ¨äº `src/config/nbaTeamMap.ts`
2. æŸ¥çœ‹æ—¥å¿—ï¼š`[Layer 2] âš ï¸ æ— æ³•æ‰¾åˆ°çƒé˜Ÿæ˜ å°„`
3. æ¯”èµ›çŠ¶æ€æ˜¯å¦ä¸º `COMPLETED`ï¼ˆä¼šè¢«é¢„è¿‡æ»¤æ‰ï¼‰

### API Key é”™è¯¯

**æ£€æŸ¥é¡¹**:
1. `.env` æ–‡ä»¶ä¸­ `POLYMARKET_API_KEY` æ˜¯å¦è®¾ç½®
2. API Key æ˜¯å¦æœ‰æ•ˆ
3. æŸ¥çœ‹ `logs/error.log` äº†è§£è¯¦ç»†é”™è¯¯

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç¼“å­˜ç­–ç•¥

ä»·æ ¼æ•°æ®ä¼šè¢«ç¼“å­˜ï¼š
- è¿›è¡Œä¸­çš„æ¯”èµ›: 45 ç§’
- æœªå¼€å§‹çš„æ¯”èµ›: 120 ç§’
- å·²ç»“æŸçš„æ¯”èµ›: 24 å°æ—¶

### 2. é”™è¯¯å¤„ç†

```typescript
try {
  const polyData = await polymarketService.searchNBAMarkets(home, away);
  if (!polyData) {
    // Polymarket å¯èƒ½æ²¡æœ‰è¿™åœºæ¯”èµ›çš„å¸‚åœº
    logger.info('æœªæ‰¾åˆ° Polymarket å¸‚åœº');
  }
} catch (error) {
  // ç½‘ç»œé”™è¯¯æˆ– API é”™è¯¯
  logger.error('è·å–ä»·æ ¼å¤±è´¥:', error);
}
```

### 3. æ—¥å¿—ç›‘æ§

å…³é”®æ—¥å¿—æ ‡è®°ï¼š
- `[Layer 1]` - èŒƒå›´é”å®šçŠ¶æ€
- `[Layer 2]` - åç§°åŒ¹é…ç»“æœ
- `[Layer 3]` - æ—¶é—´æ ¡éªŒç»“æœ

---

## ğŸ“ˆ æ€§èƒ½æ•°æ®

### å½“å‰æŒ‡æ ‡

- **åŒ¹é…æˆåŠŸç‡**: 100%ï¼ˆå¯¹äº Polymarket æœ‰å¸‚åœºçš„æ¯”èµ›ï¼‰
- **API å“åº”æ—¶é—´**: < 1 ç§’
- **ç¼“å­˜å‘½ä¸­ç‡**: > 90%
- **æ¯åˆ†é’Ÿè¯·æ±‚æ•°**: < 60ï¼ˆç¬¦åˆé™æµè¦æ±‚ï¼‰

### ä¼˜åŒ–æªæ–½

1. âœ… é¢„è¿‡æ»¤å·²ç»“æŸçš„æ¯”èµ›ï¼ˆå‡å°‘ API è°ƒç”¨ï¼‰
2. âœ… ä½¿ç”¨ä¸­æ–‡é˜Ÿåç›´æ¥æ˜ å°„ï¼ˆé¿å…é¢å¤–æŸ¥è¯¢ï¼‰
3. âœ… Layer 1 è¿‡æ»¤å‡å°‘å¾…åŒ¹é…çš„äº‹ä»¶æ•°é‡
4. âœ… ç¼“å­˜ä»·æ ¼æ•°æ®ï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰

---

## ğŸ‰ æ€»ç»“

**Polymarket ä»·æ ¼è·å–åŠŸèƒ½å·²å®Œå…¨å®ç°å¹¶æ­£å¸¸å·¥ä½œï¼**

- ä¸‰å±‚æ¼æ–—åŒ¹é…ç¡®ä¿ç²¾å‡†åº¦
- ä¸»å®¢åœºé¡ºåºé—®é¢˜å·²è§£å†³
- 100% åŒ¹é…æˆåŠŸç‡ï¼ˆå¯¹äºæœ‰å¸‚åœºçš„æ¯”èµ›ï¼‰
- å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- è¯¦ç»†çš„æ–‡æ¡£å’Œæµ‹è¯•ç”¨ä¾‹

ç°åœ¨ä½ å¯ä»¥æ”¾å¿ƒä½¿ç”¨ä»·æ ¼æ•°æ®è¿›è¡Œå¥—åˆ©åˆ†æäº†ï¼ğŸš€
